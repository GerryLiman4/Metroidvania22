[gd_scene load_steps=20 format=3 uid="uid://dh2v1mpv02wq0"]

[ext_resource type="Script" path="res://Component/Player/player.gd" id="1_x2mr2"]
[ext_resource type="PackedScene" uid="uid://3jirgrp83pq" path="res://Component/player_bullet.tscn" id="2_1l3hs"]
[ext_resource type="PackedScene" uid="uid://cmuds76iodbtf" path="res://Component/upgraded_player_bullet.tscn" id="3_5k2n6"]
[ext_resource type="Script" path="res://addons/godot_state_charts/state_chart.gd" id="3_51okl"]
[ext_resource type="Texture2D" uid="uid://dx7ciwflmpexa" path="res://Resources/MainCharacter/arm pistol front.png" id="3_wcq8k"]
[ext_resource type="Texture2D" uid="uid://b7nlnr3m1ynt3" path="res://Resources/MainCharacter/head 128.png" id="4_bqkva"]
[ext_resource type="Script" path="res://addons/godot_state_charts/parallel_state.gd" id="4_oroim"]
[ext_resource type="SpriteFrames" uid="uid://ds7usjx5jo8u" path="res://Component/Player/main_character_animation.tres" id="5_13q23"]
[ext_resource type="Script" path="res://addons/godot_state_charts/compound_state.gd" id="5_hfc4i"]
[ext_resource type="Script" path="res://addons/godot_state_charts/atomic_state.gd" id="6_8dtlr"]
[ext_resource type="Script" path="res://Component/Player/player_health.gd" id="6_o0leh"]
[ext_resource type="Script" path="res://addons/godot_state_charts/transition.gd" id="7_31jtg"]
[ext_resource type="PackedScene" uid="uid://bcwkugn6v3oy7" path="res://addons/godot_state_charts/utilities/state_chart_debugger.tscn" id="8_0ixva"]

[sub_resource type="CircleShape2D" id="CircleShape2D_op8ci"]
radius = 41.0122

[sub_resource type="CapsuleShape2D" id="CapsuleShape2D_g2ocb"]
radius = 29.0
height = 126.0

[sub_resource type="RectangleShape2D" id="RectangleShape2D_ljq2t"]
size = Vector2(58, 62)

[sub_resource type="RectangleShape2D" id="RectangleShape2D_mqoqd"]
size = Vector2(108, 132)

[sub_resource type="CapsuleShape2D" id="CapsuleShape2D_psl57"]
radius = 29.0
height = 126.0

[sub_resource type="RectangleShape2D" id="RectangleShape2D_3aknh"]
size = Vector2(58, 62)

[node name="Player" type="CharacterBody2D" node_paths=PackedStringArray("audio_player", "character_state", "wall_jump_timer", "animation_player", "arm_sprite", "head_model", "head_sprite", "shooter", "player_health", "charge_area", "charge_hitbox", "collision_box", "hit_box", "head_raycast_up_left", "head_raycast_up_right", "crawl_collision", "crawl_hitbox", "leg_raycast_left", "leg_raycast_right", "head_raycast_left", "head_raycast_right") groups=["Player"]]
collision_layer = 34
script = ExtResource("1_x2mr2")
audio_player = NodePath("SoundPlayer")
character_state = NodePath("StateChart")
face_direction = 1
wall_jump_timer = NodePath("Timers/WallJumpTimer")
animation_player = NodePath("AnimatedSprite2D")
arm_sprite = NodePath("AnimatedSprite2D/Arm")
head_model = NodePath("AnimatedSprite2D/HeadModel")
head_sprite = NodePath("AnimatedSprite2D/HeadModel/Head")
bullet_pref = ExtResource("2_1l3hs")
shooter = NodePath("AnimatedSprite2D/Arm/Shooter")
player_health = NodePath("Hitbox")
charge_area = NodePath("ChargeHitbox")
charge_hitbox = NodePath("ChargeHitbox/Hitbox")
has_unlocked_charge = true
upgraded_bullet_pref = ExtResource("3_5k2n6")
has_unlocked_upgraded_gun = true
collision_box = NodePath("CollisionShape2D")
hit_box = NodePath("Hitbox/hitbox")
head_raycast_up_left = NodePath("HeadCastUpLeft")
head_raycast_up_right = NodePath("HeadCastUpRight")
crawl_collision = NodePath("CrawlCollision")
crawl_hitbox = NodePath("Hitbox/crawlhitbox")
leg_raycast_left = NodePath("LegCastLeft")
leg_raycast_right = NodePath("LegCastRight")
head_raycast_left = NodePath("HeadCastLeft")
head_raycast_right = NodePath("HeadCastRight")

[node name="AnimatedSprite2D" type="AnimatedSprite2D" parent="."]
sprite_frames = ExtResource("5_13q23")
animation = &"Idle"

[node name="HeadModel" type="Sprite2D" parent="AnimatedSprite2D"]
position = Vector2(16, 0)

[node name="Head" type="Sprite2D" parent="AnimatedSprite2D/HeadModel"]
z_index = 10
position = Vector2(-16, 0.1)
texture = ExtResource("4_bqkva")

[node name="Arm" type="Sprite2D" parent="AnimatedSprite2D"]
z_index = 15
position = Vector2(18, -5)
texture = ExtResource("3_wcq8k")
offset = Vector2(-20, 5)

[node name="Marker2D" type="Marker2D" parent="AnimatedSprite2D/Arm"]
position = Vector2(0, 4)

[node name="Shooter" type="Node2D" parent="AnimatedSprite2D/Arm"]
position = Vector2(-49, 5)

[node name="Direction" type="Marker2D" parent="AnimatedSprite2D"]
position = Vector2(-40, 0)

[node name="ActionableFinder" type="Area2D" parent="AnimatedSprite2D/Direction"]
collision_layer = 0
collision_mask = 16

[node name="CollisionShape2D" type="CollisionShape2D" parent="AnimatedSprite2D/Direction/ActionableFinder"]
shape = SubResource("CircleShape2D_op8ci")
debug_color = Color(0.819608, 0.396078, 0.2, 0.419608)

[node name="CollisionShape2D" type="CollisionShape2D" parent="."]
shape = SubResource("CapsuleShape2D_g2ocb")

[node name="CrawlCollision" type="CollisionShape2D" parent="."]
position = Vector2(0, 32)
shape = SubResource("RectangleShape2D_ljq2t")
disabled = true

[node name="ChargeHitbox" type="Area2D" parent="."]
visible = false
position = Vector2(0, -1)
collision_layer = 64
collision_mask = 32

[node name="Hitbox" type="CollisionShape2D" parent="ChargeHitbox"]
shape = SubResource("RectangleShape2D_mqoqd")
disabled = true
debug_color = Color(0.85098, 0, 0.894118, 0.419608)

[node name="Hitbox" type="Area2D" parent="." node_paths=PackedStringArray("invincible_timer") groups=["health", "player"]]
collision_layer = 34
collision_mask = 4
script = ExtResource("6_o0leh")
invincible_timer = NodePath("../Timers/InvincibleTimer")
faction_id = 1

[node name="hitbox" type="CollisionShape2D" parent="Hitbox"]
shape = SubResource("CapsuleShape2D_psl57")

[node name="crawlhitbox" type="CollisionShape2D" parent="Hitbox"]
position = Vector2(0, 32)
shape = SubResource("RectangleShape2D_3aknh")
disabled = true
debug_color = Color(0.815686, 0.392157, 0.301961, 0.419608)

[node name="SoundPlayer" type="AudioStreamPlayer" parent="."]

[node name="StateChart" type="Node" parent="."]
script = ExtResource("3_51okl")

[node name="ParallelState" type="Node" parent="StateChart"]
script = ExtResource("4_oroim")

[node name="CharacterState" type="Node" parent="StateChart/ParallelState"]
script = ExtResource("5_hfc4i")
initial_state = NodePath("Idle")

[node name="Idle" type="Node" parent="StateChart/ParallelState/CharacterState"]
script = ExtResource("6_8dtlr")

[node name="ToWalk" type="Node" parent="StateChart/ParallelState/CharacterState/Idle"]
script = ExtResource("7_31jtg")
to = NodePath("../../Walk")
event = &"WALK"

[node name="ToJump" type="Node" parent="StateChart/ParallelState/CharacterState/Idle"]
script = ExtResource("7_31jtg")
to = NodePath("../../Jump")
event = &"JUMP"

[node name="ToFall" type="Node" parent="StateChart/ParallelState/CharacterState/Idle"]
script = ExtResource("7_31jtg")
to = NodePath("../../Fall")
event = &"FALL"

[node name="ToCrawl" type="Node" parent="StateChart/ParallelState/CharacterState/Idle"]
script = ExtResource("7_31jtg")
to = NodePath("../../Crawl")
event = &"CRAWL"

[node name="ToDash" type="Node" parent="StateChart/ParallelState/CharacterState/Idle"]
script = ExtResource("7_31jtg")
to = NodePath("../../Dash")
event = &"DASH"

[node name="Walk" type="Node" parent="StateChart/ParallelState/CharacterState"]
script = ExtResource("6_8dtlr")

[node name="ToIdle" type="Node" parent="StateChart/ParallelState/CharacterState/Walk"]
script = ExtResource("7_31jtg")
to = NodePath("../../Idle")
event = &"IDLE"

[node name="ToJump" type="Node" parent="StateChart/ParallelState/CharacterState/Walk"]
script = ExtResource("7_31jtg")
to = NodePath("../../Jump")
event = &"JUMP"

[node name="ToFall" type="Node" parent="StateChart/ParallelState/CharacterState/Walk"]
script = ExtResource("7_31jtg")
to = NodePath("../../Fall")
event = &"FALL"

[node name="ToCrawl" type="Node" parent="StateChart/ParallelState/CharacterState/Walk"]
script = ExtResource("7_31jtg")
to = NodePath("../../Crawl")
event = &"CRAWL"

[node name="ToDash" type="Node" parent="StateChart/ParallelState/CharacterState/Walk"]
script = ExtResource("7_31jtg")
to = NodePath("../../Dash")
event = &"DASH"

[node name="Jump" type="Node" parent="StateChart/ParallelState/CharacterState"]
script = ExtResource("6_8dtlr")

[node name="ToFall" type="Node" parent="StateChart/ParallelState/CharacterState/Jump"]
script = ExtResource("7_31jtg")
to = NodePath("../../Fall")
event = &"FALL"

[node name="ToDoubleJump" type="Node" parent="StateChart/ParallelState/CharacterState/Jump"]
script = ExtResource("7_31jtg")
to = NodePath("../../DoubleJump")
event = &"DOUBLEJUMP"

[node name="ToDash" type="Node" parent="StateChart/ParallelState/CharacterState/Jump"]
script = ExtResource("7_31jtg")
to = NodePath("../../Dash")
event = &"DASH"

[node name="Fall" type="Node" parent="StateChart/ParallelState/CharacterState"]
script = ExtResource("6_8dtlr")

[node name="ToIdle" type="Node" parent="StateChart/ParallelState/CharacterState/Fall"]
script = ExtResource("7_31jtg")
to = NodePath("../../Idle")
event = &"IDLE"

[node name="ToDoubleJump" type="Node" parent="StateChart/ParallelState/CharacterState/Fall"]
script = ExtResource("7_31jtg")
to = NodePath("../../DoubleJump")
event = &"DOUBLEJUMP"

[node name="ToDash" type="Node" parent="StateChart/ParallelState/CharacterState/Fall"]
script = ExtResource("7_31jtg")
to = NodePath("../../Dash")
event = &"DASH"

[node name="ToWallLatch" type="Node" parent="StateChart/ParallelState/CharacterState/Fall"]
script = ExtResource("7_31jtg")
to = NodePath("../../WallLatch")
event = &"WALLLATCH"

[node name="DoubleJump" type="Node" parent="StateChart/ParallelState/CharacterState"]
script = ExtResource("6_8dtlr")

[node name="ToFall" type="Node" parent="StateChart/ParallelState/CharacterState/DoubleJump"]
script = ExtResource("7_31jtg")
to = NodePath("../../Fall")
event = &"FALL"

[node name="WallLatch" type="Node" parent="StateChart/ParallelState/CharacterState"]
script = ExtResource("6_8dtlr")

[node name="ToWallJump" type="Node" parent="StateChart/ParallelState/CharacterState/WallLatch"]
script = ExtResource("7_31jtg")
to = NodePath("../../WallJump")
event = &"WALLJUMP"

[node name="ToIdle" type="Node" parent="StateChart/ParallelState/CharacterState/WallLatch"]
script = ExtResource("7_31jtg")
to = NodePath("../../Idle")
event = &"IDLE"

[node name="ToDash" type="Node" parent="StateChart/ParallelState/CharacterState/WallLatch"]
script = ExtResource("7_31jtg")
to = NodePath("../../Dash")
event = &"DASH"

[node name="WallJump" type="Node" parent="StateChart/ParallelState/CharacterState"]
script = ExtResource("6_8dtlr")

[node name="ToFall" type="Node" parent="StateChart/ParallelState/CharacterState/WallJump"]
script = ExtResource("7_31jtg")
to = NodePath("../../Fall")
event = &"FALL"

[node name="ToIdle" type="Node" parent="StateChart/ParallelState/CharacterState/WallJump"]
script = ExtResource("7_31jtg")
to = NodePath("../../Idle")
event = &"IDLE"

[node name="Crawl" type="Node" parent="StateChart/ParallelState/CharacterState"]
script = ExtResource("6_8dtlr")

[node name="ToFall" type="Node" parent="StateChart/ParallelState/CharacterState/Crawl"]
script = ExtResource("7_31jtg")
to = NodePath("../../Fall")
event = &"FALL"

[node name="ToIdle" type="Node" parent="StateChart/ParallelState/CharacterState/Crawl"]
script = ExtResource("7_31jtg")
to = NodePath("../../Idle")
event = &"IDLE"

[node name="Dash" type="Node" parent="StateChart/ParallelState/CharacterState"]
script = ExtResource("6_8dtlr")

[node name="ToFall" type="Node" parent="StateChart/ParallelState/CharacterState/Dash"]
script = ExtResource("7_31jtg")
to = NodePath("../../Fall")
event = &"FALL"

[node name="ToIdle" type="Node" parent="StateChart/ParallelState/CharacterState/Dash"]
script = ExtResource("7_31jtg")
to = NodePath("../../Idle")
event = &"IDLE"

[node name="StateChartDebugger" parent="." instance=ExtResource("8_0ixva")]
offset_left = -225.0
offset_top = -356.0
offset_right = 236.0
offset_bottom = -81.0
initial_node_to_watch = NodePath("../StateChart")

[node name="AudioStreamPlayer" type="AudioStreamPlayer" parent="."]
bus = &"SFX"

[node name="Timers" type="Node2D" parent="."]

[node name="WallJumpTimer" type="Timer" parent="Timers"]
wait_time = 0.35

[node name="InvincibleTimer" type="Timer" parent="Timers"]
wait_time = 2.25

[node name="LegCastLeft" type="RayCast2D" parent="."]
position = Vector2(0, 56)
target_position = Vector2(-35, 0)

[node name="LegCastRight" type="RayCast2D" parent="."]
position = Vector2(0, 56)
target_position = Vector2(35, 0)

[node name="HeadCastLeft" type="RayCast2D" parent="."]
position = Vector2(0, -60)
target_position = Vector2(-35, 0)

[node name="HeadCastRight" type="RayCast2D" parent="."]
modulate = Color(1, 0.596078, 0.431373, 1)
position = Vector2(0, -60)
target_position = Vector2(35, 0)

[node name="HeadCastUpLeft" type="RayCast2D" parent="."]
modulate = Color(1, 0.596078, 0.431373, 1)
position = Vector2(-22, -38)
target_position = Vector2(0, -25)
hit_from_inside = true

[node name="HeadCastUpRight" type="RayCast2D" parent="."]
modulate = Color(1, 0.596078, 0.431373, 1)
position = Vector2(24, -38)
target_position = Vector2(0, -25)
hit_from_inside = true

[connection signal="area_entered" from="ChargeHitbox" to="." method="_on_charge_hitbox_area_entered"]
[connection signal="state_entered" from="StateChart/ParallelState/CharacterState/Idle" to="." method="_on_idle_state_entered"]
[connection signal="state_exited" from="StateChart/ParallelState/CharacterState/Idle" to="." method="_on_idle_state_exited"]
[connection signal="state_input" from="StateChart/ParallelState/CharacterState/Idle" to="." method="_on_idle_state_input"]
[connection signal="state_physics_processing" from="StateChart/ParallelState/CharacterState/Idle" to="." method="_on_idle_state_physics_processing"]
[connection signal="state_entered" from="StateChart/ParallelState/CharacterState/Walk" to="." method="_on_walk_state_entered"]
[connection signal="state_exited" from="StateChart/ParallelState/CharacterState/Walk" to="." method="_on_walk_state_exited"]
[connection signal="state_input" from="StateChart/ParallelState/CharacterState/Walk" to="." method="_on_walk_state_input"]
[connection signal="state_physics_processing" from="StateChart/ParallelState/CharacterState/Walk" to="." method="_on_walk_state_physics_processing"]
[connection signal="state_processing" from="StateChart/ParallelState/CharacterState/Walk" to="." method="_on_walk_state_processing"]
[connection signal="state_entered" from="StateChart/ParallelState/CharacterState/Jump" to="." method="_on_jump_state_entered"]
[connection signal="state_exited" from="StateChart/ParallelState/CharacterState/Jump" to="." method="_on_jump_state_exited"]
[connection signal="state_input" from="StateChart/ParallelState/CharacterState/Jump" to="." method="_on_jump_state_input"]
[connection signal="state_physics_processing" from="StateChart/ParallelState/CharacterState/Jump" to="." method="_on_jump_state_physics_processing"]
[connection signal="state_entered" from="StateChart/ParallelState/CharacterState/Fall" to="." method="_on_fall_state_entered"]
[connection signal="state_exited" from="StateChart/ParallelState/CharacterState/Fall" to="." method="_on_fall_state_exited"]
[connection signal="state_input" from="StateChart/ParallelState/CharacterState/Fall" to="." method="_on_fall_state_input"]
[connection signal="state_physics_processing" from="StateChart/ParallelState/CharacterState/Fall" to="." method="_on_fall_state_physics_processing"]
[connection signal="state_entered" from="StateChart/ParallelState/CharacterState/DoubleJump" to="." method="_on_double_jump_state_entered"]
[connection signal="state_exited" from="StateChart/ParallelState/CharacterState/DoubleJump" to="." method="_on_double_jump_state_exited"]
[connection signal="state_input" from="StateChart/ParallelState/CharacterState/DoubleJump" to="." method="_on_double_jump_state_input"]
[connection signal="state_physics_processing" from="StateChart/ParallelState/CharacterState/DoubleJump" to="." method="_on_double_jump_state_physics_processing"]
[connection signal="state_entered" from="StateChart/ParallelState/CharacterState/WallLatch" to="." method="_on_wall_latch_state_entered"]
[connection signal="state_exited" from="StateChart/ParallelState/CharacterState/WallLatch" to="." method="_on_wall_latch_state_exited"]
[connection signal="state_input" from="StateChart/ParallelState/CharacterState/WallLatch" to="." method="_on_wall_latch_state_input"]
[connection signal="state_physics_processing" from="StateChart/ParallelState/CharacterState/WallLatch" to="." method="_on_wall_latch_state_physics_processing"]
[connection signal="state_entered" from="StateChart/ParallelState/CharacterState/WallJump" to="." method="_on_wall_jump_state_entered"]
[connection signal="state_exited" from="StateChart/ParallelState/CharacterState/WallJump" to="." method="_on_wall_jump_state_exited"]
[connection signal="state_input" from="StateChart/ParallelState/CharacterState/WallJump" to="." method="_on_wall_jump_state_input"]
[connection signal="state_physics_processing" from="StateChart/ParallelState/CharacterState/WallJump" to="." method="_on_wall_jump_state_physics_processing"]
[connection signal="state_entered" from="StateChart/ParallelState/CharacterState/Crawl" to="." method="_on_crawl_state_entered"]
[connection signal="state_exited" from="StateChart/ParallelState/CharacterState/Crawl" to="." method="_on_crawl_state_exited"]
[connection signal="state_input" from="StateChart/ParallelState/CharacterState/Crawl" to="." method="_on_crawl_state_input"]
[connection signal="state_physics_processing" from="StateChart/ParallelState/CharacterState/Crawl" to="." method="_on_crawl_state_physics_processing"]
[connection signal="state_entered" from="StateChart/ParallelState/CharacterState/Dash" to="." method="_on_dash_state_entered"]
[connection signal="state_exited" from="StateChart/ParallelState/CharacterState/Dash" to="." method="_on_dash_state_exited"]
[connection signal="state_input" from="StateChart/ParallelState/CharacterState/Dash" to="." method="_on_dash_state_input"]
[connection signal="state_physics_processing" from="StateChart/ParallelState/CharacterState/Dash" to="." method="_on_dash_state_physics_processing"]
[connection signal="timeout" from="Timers/WallJumpTimer" to="." method="_on_wall_jump_timer_timeout"]
[connection signal="timeout" from="Timers/InvincibleTimer" to="Hitbox" method="_on_invincible_timer_timeout"]
